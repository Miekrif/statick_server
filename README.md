
# Проект Ansible для Сервера Статики

Этот проект настраивает сервер для раздачи статических файлов с использованием Ansible и Docker. Сервер настраивается для раздачи статических изображений через Nginx с поддержкой gzip-сжатия и кэширования. Проект предназначен для легкого развертывания и масштабируемости в контейнере Docker.

## Структура проекта

- **docker/**: Содержит `Dockerfile` и `docker-compose.yml` для настройки тестовой среды с доступом по SSH.
- **playbooks/**: Содержит основной плейбук `setup_static_server.yml` для развертывания сервера статики, а также файл `vars/main.yml` с настройками.
- **inventory/**: Файл `hosts.ini`, определяющий инвентарь Ansible.
- **roles/**: Директория с Ansible ролями для настройки сервера.

### Роли

1. **user_management**: Управление созданием пользователей, назначением групп и настройкой SSH-ключей. Все параметры пользователей настраиваются через файл `vars/main.yml`:
    - Имя пользователя
    - Оболочка (bash/zsh/etc)
    - Состояние (создан/удален)
    - Публичный ключ для SSH
    - Пароль
    - Список групп (включая кастомные группы)

2. **zsh_setup**: Устанавливает Zsh и Oh My Zsh для пользователей, у которых оболочка настроена как Zsh.
3. **ssh_config**: Настраивает SSH, отключая вход для root, запрещая пустые пароли, включая подробное логгирование и отключая X11Forwarding.
4. **package_install**: Устанавливает необходимые пакеты, такие как `htop`, `ncdu`, `git`, и `nano`.
5. **nginx_setup**: Устанавливает и настраивает Nginx для раздачи изображений с gzip-сжатием, кэшированием и логированием.
6. **static_content**: Загружает и размещает статический контент (изображения) с URL, указанного в `vars/main.yml`. Если URL недоступен, используется локальный архив.

## Использование

### Предварительные требования

- Установленные Docker и Docker Compose.
- Установленный Ansible на хост-машине.

### Шаги для развертывания

1. **Создайте Docker-контейнер**

   Перейдите в директорию проекта и выполните команду:

   ```bash
   docker-compose -f docker/docker-compose.yml up --build -d
   ```

2. **Запустите Ansible плейбук**

   Когда контейнер Docker запущен, выполните плейбук Ansible:

   ```bash
   ansible-playbook -i inventory/hosts.ini playbooks/setup_static_server.yml
   ```

3. **Доступ к серверу статики**

   - Откройте браузер и перейдите на `http://localhost/images`, чтобы увидеть директорию с изображениями.
   - Перейдите на `http://localhost/images/<имя_файла>`, чтобы просмотреть отдельные изображения.

### Настройки

- **URL для статики и локальный архив**: 
  - В файле `vars/main.yml` можно указать `image_url` для загрузки изображений и `local_archive_path` для локального архива.
  - Если `image_url` недоступен, роль `static_content` автоматически использует архив из `local_archive_path` (например, `roles/static_content/files/More clouds from me.zip`).

- **Управление пользователями и группами**: 
  - Пользователи, группы и их параметры (включая SSH-ключи и пароли) настраиваются через `vars/main.yml`.

## Примечания

- Все роли идемпотентны и могут быть запущены повторно без изменений в настройках.
- Nginx настроен на кэширование изображений на 1 час и сжатие статики с помощью gzip.
- Стандартные настройки SSH повышают безопасность, ограничивая доступ.

## Лицензия

Этот проект распространяется по лицензии MIT.
